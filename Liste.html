<!doctype>
<html>

  <head>
    <meta charset="utf-8">
    <title>Die Liste</title>
    <meta name="viewport" content="width=device-width, initioal-scale=1">
    <link rel="stylesheet" href="main.css">
  </head>

  <body>

    <h1>Wer zu viel Säuft</h1>

    <ul id="list">

    </ul>


    
    <script>
      //let listNames = ['Johannes']; <--Wird mit php deklariert
      let menge = [0];
      let splitCookie = [];
      let anzahlLoaded = 0;
      let notFound = 0;
      let arrayLoaded = [];

      /*
      let storage = sessionStorage.getItem('menge');    Local Storage nicht mehr nötig es soll immer die neuste version von txt geladen werden.
      let nameStorage = sessionStorage.getItem('name');

      if (storage == null){
        menge = [0];
      } else {
        menge = [0];
        storage = storage.split(',');
        asciToDec(storage);
      }

      if (nameStorage != null){
        listNames = nameStorage.split(',');
      }
      */

      neuLaden(0);

      menge = zwisch;

      updateList(menge);


      /*War nur für Local Strage nötig
      function asciToDec(storage){
        for (let i = 0; i < storage.length; i += 1){
          for (let m = 0; m < 100; m += 1){
            if (storage[i] == m){
              menge[i] = m;
            }
          }  
        }
      }
      */


      function addBeer(person){
        menge[person] += 1;

        sessionStorage.setItem('menge', menge);

        updateList(menge);
        neuLaden(1);
      }


      function updateList(menge){

        document.getElementById('list').innerHTML = ' ';

        for (let index = 0; index < listNames.length; index += 1) {
          document.getElementById('list').innerHTML += listNames[index] + ' ' + menge[index] + '   <button onclick="addBeer(' + index + ');", class="buttonBeer"></button>' + '<br><br>';
        }
        document.cookie = "menge=let zwisch = [" + menge + "]";      //+ new Date(2021, 3, 13).toUTCString()

        neuLaden(0);
      }

      function neuLaden(laden){
        console.log("neuLaden ausführen");

        if(laden != 0) {
          document.cookie = "loaded=0";
        }
        else {
          laden = 1;
        }

        splitCookie = document.cookie.split(';');
        console.log(document.cookie);

        for(let i = 0; i < splitCookie.length; i++) {
          if(splitCookie[i].includes("loaded", 0)) {
            arrayLoaded = splitCookie[i].split("=");
            anzahlLoaded = arrayLoaded[1];
          }
          else {
            notFound++;
          }
        }

        if(anzahlLoaded == 0) {
          document.getElementById('list').innerHTML += '<meta http-equiv="refresh" content="0">';
          document.cookie = "loaded=" + laden;
        }
        else if(anzahlLoaded == 2) {
          document.cookie = "addName=";
          document.cookie = "loaded=1";
        }
        
        if(notFound == splitCookie.length) {
          document.cookie = "loaded=0";
        }
      }


      function addNewName(){
        let eingabe = window.prompt('Gib den Namen den du hinzufügen möchtest ein:');


        if (eingabe != null){
          let passwort = window.prompt("Passwort");

          if(passwort == "Ja") {
            listNames.push(eingabe);

            menge.push(0);

            document.cookie = "addName=" + ", '" + eingabe + "'";
            console.log("In addNewName: addName=" + eingabe);           //  <--

            updateList(menge);
            neuLaden(2);
        }
        //sessionStorage.setItem('name', listNames);    nicht nötig weil alles über save.txt
        //sessionStorage.setItem('menge', menge);
        }
      }

    </script>

    <button onclick="addNewName()">Neuen Namen hinzufügen</button>

    <br>
    <br>
    <img src="Beer.png">
    <p></p>
    <br><br><br><br><br><br><br><br><br><br>

    <meta http-equiv="refresh" content="1500"> <!--Alle 25min neu Laden wegen Server-->

    <!--
    <a href="https://drv.tw" target="_blank">www.drv.tw</a>
    -->

  </body>

</html>

<!---
 nameList.push(anzahl);
let nameList = [];
let anzahl = window.prompt(listNames[person] + ' gib ein wie viel Bier:');


--->